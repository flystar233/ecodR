# ecodR

<!-- badges: start -->
[![R-CMD-check](https://github.com/yourusername/ecodR/workflows/R-CMD-check/badge.svg)](https://github.com/yourusername/ecodR/actions)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
<!-- badges: end -->

## æ¦‚è¿°

**ecodR** æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å‚æ•°æ— å…³çš„å¼‚å¸¸æ£€æµ‹ R åŒ…ï¼Œå®ç°äº† ECOD (Empirical Cumulative Distribution-Based Outlier Detection) ç®—æ³•ã€‚

### ä¸»è¦ç‰¹ç‚¹

- âš¡ **æå¿«çš„é€Ÿåº¦** - æ—¶é—´å¤æ‚åº¦ O(n log n)
- ğŸ¯ **é›¶å‚æ•°è°ƒä¼˜** - å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€è°ƒå‚
- ğŸ“Š **é«˜åº¦å¯è§£é‡Š** - æä¾›ç‰¹å¾çº§åˆ«çš„å°¾éƒ¨æ¦‚ç‡
- ğŸ”§ **å°ºåº¦ä¸å˜** - åŸºäºç§©ï¼Œå¯¹ç‰¹å¾å°ºåº¦ä¸æ•æ„Ÿ
- ğŸ’¾ **å†…å­˜é«˜æ•ˆ** - åªå­˜å‚¨å¿…è¦çš„ç»Ÿè®¡ä¿¡æ¯

## å®‰è£…

```r
#ä» GitHub å®‰è£…
devtools::install_github("flystar233/ecodR")
```

## å¿«é€Ÿå¼€å§‹

```r
library(ecodR)

# ä½¿ç”¨ iris æ•°æ®é›†
data(iris)
X <- iris[, 1:4]

# è®­ç»ƒ ECOD æ¨¡å‹
model <- ecod(X)

# æŸ¥çœ‹ç»“æœ
print(model)
#> ECOD Anomaly Detection Model
#> ==============================
#> 
#> Number of samples: 150 
#> Number of features: 4 
#> Data normalized: FALSE 
#> 
#> Anomaly Score Summary:
#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#>   4.039   6.046   6.923   6.554   7.182   7.976

# è¯†åˆ«å¼‚å¸¸ï¼ˆå‰5%ï¼‰
outliers <- get_outliers(model, threshold = "0.95", return_indices = TRUE)
print(outliers)

# å¯è§†åŒ–
plot(model, type = "scores")       # åˆ†æ•°åˆ†å¸ƒ
plot(model, type = "ranked")       # æ’åºå›¾
plot(model, type = "features")     # ç‰¹å¾è´¡çŒ®çƒ­å›¾
```

## è¯¦ç»†ç¤ºä¾‹

### åŸºç¡€å¼‚å¸¸æ£€æµ‹

```r
# ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
set.seed(42)

# æ­£å¸¸æ•°æ®
X_normal <- data.frame(
  x1 = rnorm(1000, 0, 1),
  x2 = rnorm(1000, 0, 1),
  x3 = rnorm(1000, 0, 1)
)

# å¼‚å¸¸æ•°æ®
X_anomaly <- data.frame(
  x1 = rnorm(50, 3, 0.5),
  x2 = rnorm(50, -3, 0.5),
  x3 = rnorm(50, 0, 3)
)

X_all <- rbind(X_normal, X_anomaly)
y_true <- c(rep("Normal", 1000), rep("Anomaly", 50))

# æ£€æµ‹å¼‚å¸¸
model <- ecod(X_all)

# è¯„ä¼°æ€§èƒ½
library(pROC)
y_binary <- ifelse(y_true == "Anomaly", 1, 0)
roc_obj <- roc(y_binary, model$scores)
cat("AUC-ROC:", auc(roc_obj), "\n")
#> AUC-ROC: 0.942

# å¯è§†åŒ– ROC æ›²çº¿
plot(roc_obj, main = "ECOD ROC Curve")
```

### ç‰¹å¾è´¡çŒ®åˆ†æ

```r
# æ‰¾åˆ°æœ€å¼‚å¸¸çš„æ ·æœ¬
most_anomalous <- which.max(model$scores)

# æŸ¥çœ‹è¯¥æ ·æœ¬çš„ç‰¹å¾è´¡çŒ®
contrib <- feature_contributions(model, most_anomalous)
print(contrib)
#> Sepal.Width Petal.Width Petal.Length Sepal.Length
#>       3.912       2.456        1.234        0.987

# å¯è§†åŒ–ç‰¹å¾è´¡çŒ®
barplot(contrib, las = 2, col = "steelblue",
        main = paste("Feature Contributions - Sample", most_anomalous),
        ylab = "Contribution Score")
```

### é¢„æµ‹æ–°æ•°æ®

```r
# åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†
X_train <- iris[1:100, 1:4]
X_test <- iris[101:150, 1:4]

# è®­ç»ƒæ¨¡å‹
model <- ecod(X_train)

# é¢„æµ‹æµ‹è¯•é›†
scores_test <- predict(model, X_test, X_train)

# æŸ¥çœ‹é¢„æµ‹ç»“æœ
summary(scores_test)
#>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#>   5.123   5.456   6.012   6.234   6.789   8.901
```

### è‡ªå®šä¹‰é˜ˆå€¼

```r
model <- ecod(iris[, 1:4])

# ä½¿ç”¨ä¸åŒçš„é˜ˆå€¼
outliers_95 <- get_outliers(model, threshold = "0.95")  # å‰5%
outliers_99 <- get_outliers(model, threshold = "0.99")  # å‰1%

cat("5% threshold:", sum(outliers_95), "outliers\n")
cat("1% threshold:", sum(outliers_99), "outliers\n")
```

## ç®—æ³•åŸç†

### æ ¸å¿ƒæ€æƒ³

ECOD (Empirical Cumulative Distribution-based Outlier Detection) çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å¼‚å¸¸æ ·æœ¬åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ç»´åº¦ä¸Šä¼šå‘ˆç°æç«¯å€¼ï¼ˆè½åœ¨åˆ†å¸ƒçš„å°¾éƒ¨ï¼‰**ã€‚é€šè¿‡è®¡ç®—æ¯ä¸ªæ ·æœ¬åœ¨å„ç‰¹å¾ä¸Šçš„å°¾éƒ¨æ¦‚ç‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡åŒ–å…¶å¼‚å¸¸ç¨‹åº¦ã€‚

### ç®—æ³•æ­¥éª¤è¯¦è§£

#### æ­¥éª¤ 1ï¼šè®¡ç®—ç»éªŒç´¯ç§¯åˆ†å¸ƒå‡½æ•° (ECDF)

å¯¹äºæ¯ä¸ªç‰¹å¾ $j$ï¼ŒåŸºäºè®­ç»ƒæ•°æ®è®¡ç®—å…¶ç»éªŒç´¯ç§¯åˆ†å¸ƒå‡½æ•° $F_j(x)$ï¼š

$$
F_j(x) = \frac{1}{n} \sum_{i=1}^{n} \mathbb{1}(x_{ij} \leq x)
$$

å…¶ä¸­ï¼š
- $n$ æ˜¯æ ·æœ¬æ•°é‡
- $x_{ij}$ æ˜¯ç¬¬ $i$ ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ $j$ ä¸Šçš„å–å€¼
- $\mathbb{1}(\cdot)$ æ˜¯æŒ‡ç¤ºå‡½æ•°

**ç›´è§‰ç†è§£**ï¼šECDF å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨æŸä¸ªç‰¹å¾ä¸Šï¼Œæœ‰å¤šå°‘æ¯”ä¾‹çš„æ•°æ®å°äºç­‰äºç»™å®šå€¼ã€‚ä¾‹å¦‚ï¼Œ$F_j(x) = 0.95$ æ„å‘³ç€ 95% çš„æ•°æ®å°äºç­‰äº $x$ã€‚

**å®ç°ç»†èŠ‚**ï¼šåˆ©ç”¨æ’åºåçš„ç§©æ¥å¿«é€Ÿè®¡ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n \log n)$ã€‚

#### æ­¥éª¤ 2ï¼šè®¡ç®—å°¾éƒ¨æ¦‚ç‡

å¯¹äºæ¯ä¸ªæ ·æœ¬-ç‰¹å¾å¯¹ $(i, j)$ï¼Œè®¡ç®—å…¶å°¾éƒ¨æ¦‚ç‡ï¼š

$$
T_{ij} = \min(F_j(x_{ij}), 1 - F_j(x_{ij}))
$$

**ç›´è§‰ç†è§£**ï¼š
- å¦‚æœ $x_{ij}$ å¾ˆå¤§ï¼ˆå³å°¾éƒ¨ï¼‰ï¼Œåˆ™ $F_j(x_{ij}) \approx 1$ï¼Œå› æ­¤ $1 - F_j(x_{ij}) \approx 0$
- å¦‚æœ $x_{ij}$ å¾ˆå°ï¼ˆå·¦å°¾éƒ¨ï¼‰ï¼Œåˆ™ $F_j(x_{ij}) \approx 0$
- **å–æœ€å°å€¼ç¡®ä¿åŒæ—¶æ•æ‰ä¸¤ä¾§çš„æç«¯å€¼**

**ç¤ºä¾‹**ï¼š
```r
# å‡è®¾æŸç‰¹å¾çš„ ECDF å€¼ä¸ºï¼š
F(x) = 0.95  â†’  T = min(0.95, 0.05) = 0.05  # å³å°¾éƒ¨ï¼Œå¼‚å¸¸
F(x) = 0.50  â†’  T = min(0.50, 0.50) = 0.50  # ä¸­é—´ï¼Œæ­£å¸¸
F(x) = 0.03  â†’  T = min(0.03, 0.97) = 0.03  # å·¦å°¾éƒ¨ï¼Œå¼‚å¸¸
```

å°¾éƒ¨æ¦‚ç‡ $T_{ij}$ è¶Šå°ï¼Œè¡¨ç¤ºè¯¥æ ·æœ¬åœ¨è¯¥ç‰¹å¾ä¸Šè¶Šå¼‚å¸¸ã€‚

#### æ­¥éª¤ 3ï¼šèšåˆå¼‚å¸¸åˆ†æ•°

å¯¹æ¯ä¸ªæ ·æœ¬ï¼Œå°†å…¶åœ¨æ‰€æœ‰ç‰¹å¾ä¸Šçš„å°¾éƒ¨æ¦‚ç‡èšåˆä¸ºæœ€ç»ˆçš„å¼‚å¸¸åˆ†æ•°ï¼š

$$
\text{score}_i = \sum_{j=1}^{d} (-\log T_{ij})
$$

å…¶ä¸­ $d$ æ˜¯ç‰¹å¾æ•°é‡ã€‚

**ä¸ºä»€ä¹ˆä½¿ç”¨ $-\log$ï¼Ÿ**

ä½¿ç”¨è´Ÿå¯¹æ•°å˜æ¢æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ä¿¡æ¯è®ºä¾æ®**ï¼š$-\log(p)$ è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿçš„"æƒŠè®¶åº¦"æˆ–"è‡ªä¿¡æ¯"
   ```r
   T = 0.9   â†’  -log(0.9) â‰ˆ 0.11   # æ­£å¸¸ï¼Œä½åˆ†æ•°
   T = 0.1   â†’  -log(0.1) â‰ˆ 2.30   # å¼‚å¸¸ï¼Œé«˜åˆ†æ•°
   T = 0.01  â†’  -log(0.01) â‰ˆ 4.61  # æç«¯å¼‚å¸¸ï¼Œå¾ˆé«˜åˆ†æ•°
   ```

2. **å•è°ƒé€’å‡**ï¼šæ¦‚ç‡è¶Šå°ï¼ˆè¶Šå¼‚å¸¸ï¼‰ï¼Œåˆ†æ•°è¶Šé«˜

3. **å¯åŠ æ€§**ï¼šå‡è®¾ç‰¹å¾ç‹¬ç«‹ï¼Œè”åˆæ¦‚ç‡çš„å¯¹æ•° = å„ç‰¹å¾å¯¹æ•°ä¹‹å’Œ
   
   $$
   -\log(\prod_{j} T_{ij}) = \sum_{j} (-\log T_{ij})
   $$

4. **å°ºåº¦åˆç†**ï¼šå°† $(0, 1]$ æ˜ å°„åˆ° $[0, \infty)$ï¼Œæ— ä¸Šç•Œä½†å¹³æ»‘

**æœ€ç»ˆç»“æœ**ï¼šåˆ†æ•°è¶Šé«˜ï¼Œæ ·æœ¬è¶Šå¼‚å¸¸ã€‚

### å®Œæ•´ç¤ºä¾‹

å‡è®¾æœ‰ 3 ä¸ªæ ·æœ¬ï¼Œ2 ä¸ªç‰¹å¾ï¼š

| æ ·æœ¬ | Feature 1 | Feature 2 | Fâ‚(x) | Fâ‚‚(x) | Tâ‚ | Tâ‚‚ | -log(Tâ‚) | -log(Tâ‚‚) | Score |
|------|-----------|-----------|-------|-------|----|----|----------|----------|-------|
| 1    | 5.0       | 10.0      | 0.50  | 0.48  | 0.50 | 0.48 | 0.69 | 0.73 | **1.42** |
| 2    | 8.5       | 11.2      | 0.85  | 0.75  | 0.15 | 0.25 | 1.90 | 1.39 | **3.29** |
| 3    | 12.0      | 2.1       | 0.98  | 0.05  | 0.02 | 0.05 | 3.91 | 3.00 | **6.91** |

æ ·æœ¬ 3 çš„åˆ†æ•°æœ€é«˜ï¼ˆ6.91ï¼‰ï¼Œå› ä¸ºå®ƒåœ¨ä¸¤ä¸ªç‰¹å¾ä¸Šéƒ½å¾ˆæç«¯ã€‚

### æ—¶é—´å¤æ‚åº¦åˆ†æ

- **è®­ç»ƒé˜¶æ®µ**ï¼š
  - æ’åºï¼š$O(nd \log n)$
  - è®¡ç®— ECDFï¼š$O(nd)$
  - æ€»è®¡ï¼š**$O(nd \log n)$**

- **é¢„æµ‹é˜¶æ®µ**ï¼š
  - å¯¹ $m$ ä¸ªæ–°æ ·æœ¬ï¼š**$O(md \log n)$**

å…¶ä¸­ $n$ æ˜¯è®­ç»ƒæ ·æœ¬æ•°ï¼Œ$d$ æ˜¯ç‰¹å¾æ•°ï¼Œ$m$ æ˜¯æµ‹è¯•æ ·æœ¬æ•°ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼ŒIsolation Forest çš„å¤æ‚åº¦ä¸º $O(nt \log^2 n)$ï¼Œå…¶ä¸­ $t$ æ˜¯æ ‘çš„æ•°é‡ï¼ˆé€šå¸¸ 100-200ï¼‰ï¼Œå› æ­¤ ECOD å¿« **50-100 å€**ã€‚

### ä¼˜åŠ¿

- **å‚æ•°æ— å…³**ï¼šä¸éœ€è¦è°ƒæ•´ä»»ä½•å‚æ•°
- **å¿«é€Ÿ**ï¼šæ¯” Isolation Forest å¿« 50-100 å€
- **å¯è§£é‡Š**ï¼šæ¯ä¸ªç‰¹å¾çš„å°¾éƒ¨æ¦‚ç‡æä¾›äº†ç›´è§‚çš„è§£é‡Š
- **ç¨³å¥**ï¼šåŸºäºç§©ï¼Œå¯¹ç¦»ç¾¤å€¼å’Œå°ºåº¦ä¸æ•æ„Ÿ

### é€‚ç”¨åœºæ™¯

âœ… **é€‚åˆä½¿ç”¨ ECOD**ï¼š
- éœ€è¦å¿«é€Ÿæ£€æµ‹ï¼ˆå¤§è§„æ¨¡æ•°æ®ï¼‰
- ä¸æƒ³è°ƒå‚ï¼ˆè‡ªåŠ¨åŒ–æµç¨‹ï¼‰
- éœ€è¦è§£é‡Šï¼ˆç‰¹å¾è´¡çŒ®ï¼‰
- æ‰¹é‡ç¦»çº¿åˆ†æ
- è¿ç»­å‹æ•°å€¼æ•°æ®

âš ï¸ **è°¨æ…ä½¿ç”¨**ï¼š
- éœ€è¦æœ€é«˜ç²¾åº¦ï¼ˆè€ƒè™‘ Isolation Forestï¼‰
- ç±»åˆ«ç‰¹å¾ä¸ºä¸»ï¼ˆéœ€è¦ç¼–ç ï¼‰
- å®æ—¶åœ¨çº¿å­¦ä¹ ï¼ˆè€ƒè™‘ LODAï¼‰

## å‚è€ƒæ–‡çŒ®

Li, Z., Zhao, Y., Botta, N., Ionescu, C., & Hu, X. (2022). 
ECOD: Unsupervised Outlier Detection Using Empirical Cumulative Distribution Functions. 
*IEEE Transactions on Knowledge and Data Engineering*.

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE.md](LICENSE.md) æ–‡ä»¶ã€‚
